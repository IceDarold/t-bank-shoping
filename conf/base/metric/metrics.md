# README: –ú–æ–¥—É–ª—å –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ú–µ—Ç—Ä–∏–∫ (`conf/metric/`)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å **–æ—Å–Ω–æ–≤–Ω—É—é –º–µ—Ç—Ä–∏–∫—É** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ª–æ–≥–∞—Ö.

## 1. üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ú—ã —Ä–∞–∑–¥–µ–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –¥–≤–µ –≥—Ä—É–ø–ø—ã, —á—Ç–æ–±—ã —Ä–µ—à–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏:

1.  **–û—Å–Ω–æ–≤–Ω–∞—è –ú–µ—Ç—Ä–∏–∫–∞ (`main`):** –≠—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è** –º–µ—Ç—Ä–∏–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞.
    *   –ò–º–µ–Ω–Ω–æ –µ–µ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (`oof_score`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–æ–≤.
    *   –ò–º–µ–Ω–Ω–æ –µ–µ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å (–∏–ª–∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å) `Optuna` –ø—Ä–∏ –ø–æ–¥–±–æ—Ä–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    *   –û–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "—É—Å–ø–µ—à–Ω–æ—Å—Ç—å" —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞.

2.  **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ú–µ—Ç—Ä–∏–∫–∏ (`additional`):** –≠—Ç–æ **—Å–ø–∏—Å–æ–∫** –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö (`W&B`), –Ω–æ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É.
    *   –û–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Å–Ω–æ–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ ROC AUC –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—Å–æ–∫–æ–π, –Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ `Precision` –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–∞–∫–æ–º-—Ç–æ –≤–∞–∂–Ω–æ–º —Å—Ä–µ–∑–µ.
    *   –û–Ω–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

## 2. üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–∞–ø–æ–∫

–°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–æ–¥–µ–ª—è–º: –∫–∞–∂–¥—ã–π `.py` —Ñ–∞–π–ª —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫–∏ –∏–º–µ–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `.yaml` —Ñ–∞–π–ª –≤ `conf/metric/`.

```
conf/
‚îî‚îÄ‚îÄ metric/
    ‚îú‚îÄ‚îÄ roc_auc.yaml         # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è ROC AUC
    ‚îú‚îÄ‚îÄ f1_score.yaml        # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è F1-Score
    ‚îú‚îÄ‚îÄ rmse.yaml            # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è RMSE (—Ä–µ–≥—Ä–µ—Å—Å–∏—è)
    ‚îÇ
    ‚îî‚îÄ‚îÄ classification.yaml  # üëà –ü—Ä–∏–º–µ—Ä "—Å–±–æ—Ä–Ω–æ–≥–æ" –∫–æ–Ω—Ñ–∏–≥–∞
```

`src/`
‚îî‚îÄ‚îÄ `metrics/`
    ‚îú‚îÄ‚îÄ `base.py`
    ‚îú‚îÄ‚îÄ `roc_auc.py`
    ‚îú‚îÄ‚îÄ `f1_score.py`
    ‚îî‚îÄ‚îÄ `rmse.py`


---

## 3. ‚öôÔ∏è –ö–∞–∫ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ú–µ—Ç—Ä–∏–∫–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–∞–π–ª–µ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –≤ `conf/config.yaml`.

#### –ê–Ω–∞—Ç–æ–º–∏—è —Ñ–∞–π–ª–∞ `conf/metric/classification.yaml`:

–≠—Ç–æ—Ç —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è "—Å–±–æ—Ä–∫–æ–π" –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ, –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏.

```yaml
# conf/metric/classification.yaml

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –º–µ—Ç—Ä–∏–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
defaults:
  - main: roc_auc # –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª conf/metric/roc_auc.yaml
  - _self_

# –°–ø–∏—Å–æ–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
additional:
  # –ü–µ—Ä–≤–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: F1-Score
  - _target_: src.metrics.f1_score.F1ScoreMetric # –ü—Ä—è–º–æ–π –ø—É—Ç—å –∫ –∫–ª–∞—Å—Å—É
    name: "f1_macro"                             # üëà –ò–º—è –¥–ª—è –ª–æ–≥–æ–≤ –≤ W&B
    average: "macro"                             # –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è F1ScoreMetric

  # –í—Ç–æ—Ä–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: Precision@Recall=0.8 (–ø—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏)
  # - _target_: src.metrics.custom.PrecisionRecallMetric
  #   name: "precision_at_80_recall"
  #   recall_level: 0.8
```

#### –ö–∞–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `conf/config.yaml`:

```yaml
# conf/config.yaml
defaults:
  - model: lgbm
  - metric: classification # üëà –ú—ã —Å—Å—ã–ª–∞–µ–º—Å—è –Ω–∞ "—Å–±–æ—Ä–Ω—ã–π" –∫–æ–Ω—Ñ–∏–≥
  # ...
```

---

## 4. üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ü—Ä–∏–º–µ—Ä—ã –†–∞–±–æ—Ç—ã

#### –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∞:** –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—è –µ–µ –ø–æ `ROC AUC`, –Ω–æ —Ç–∞–∫–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å `F1-Score`.

**–î–µ–π—Å—Ç–≤–∏—è:**
1.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `conf/config.yaml` —É–∫–∞–∑–∞–Ω–æ `- metric: classification`.
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ: `python src/train.py`.

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
*   –°–∫—Ä–∏–ø—Ç `train.py` –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å `ROC AUC` –Ω–∞ –∫–∞–∂–¥–æ–º —Ñ–æ–ª–¥–µ –∏ —É—Å—Ä–µ–¥–Ω–∏—Ç –µ–≥–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ `oof_score`.
*   –í –ª–æ–≥–∞—Ö W&B –≤—ã —É–≤–∏–¥–∏—Ç–µ –∏ `ROC AUC`, –∏ `f1_macro` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞.

---

#### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏ "–Ω–∞ –ª–µ—Ç—É"

**–ó–∞–¥–∞—á–∞:** –ë—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –º–æ–¥–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ `F1-Score`, –∞ –Ω–µ `ROC AUC`.

**–î–µ–π—Å—Ç–≤–∏—è:**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
```bash
python src/train.py metric=f1_score
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
*   Hydra –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `metric: classification` –∏ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–∞–ø—Ä—è–º—É—é `conf/metric/f1_score.yaml`.
*   –ü–æ—Å–∫–æ–ª—å–∫—É –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ –Ω–µ—Ç —Å–µ–∫—Ü–∏–∏ `additional`, –±—É–¥—É—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ `F1-Score`.
*   –ò—Ç–æ–≥–æ–≤—ã–π `oof_score` –±—É–¥–µ—Ç —Å—Ä–µ–¥–Ω–∏–º `F1-Score` –ø–æ —Ñ–æ–ª–¥–∞–º.

---

#### –ü—Ä–∏–º–µ—Ä 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏

**–ó–∞–¥–∞—á–∞:** –í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–≤–æ—é –º–µ—Ç—Ä–∏–∫—É `LiftAtTop10Percent` –∏ —Ö–æ—Ç–∏—Ç–µ –µ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å.

**–î–µ–π—Å—Ç–≤–∏—è:**
1.  **–°–æ–∑–¥–∞—Ç—å –∫–æ–¥:** –ù–∞–ø–∏—à–∏—Ç–µ –∫–ª–∞—Å—Å `LiftAtTop10PercentMetric` –≤ `src/metrics/custom.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä).
2.  **–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥:** –û—Ç–∫—Ä–æ–π—Ç–µ `conf/metric/classification.yaml` –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–æ–∫ `additional`:

    ```yaml
    additional:
      - _target_: src.metrics.f1_score.F1ScoreMetric
        name: "f1_macro"
        average: "macro"
      
      # üëà –í–∞—à –Ω–æ–≤—ã–π –±–ª–æ–∫
      - _target_: src.metrics.custom.LiftAtTop10PercentMetric
        name: "lift_at_10_percent"
    ```
3.  **–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ:** `python src/train.py`. –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ª–æ–≥–∞—Ö W&B –ø–æ–¥ –∏–º–µ–Ω–µ–º `lift_at_10_percent`.

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–∞–µ—Ç –≤–∞–º –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ—Ü–µ–Ω–∫–æ–π –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π, –ø–æ–∑–≤–æ–ª—è—è –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–¥ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ª—é–±–æ–≥–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.